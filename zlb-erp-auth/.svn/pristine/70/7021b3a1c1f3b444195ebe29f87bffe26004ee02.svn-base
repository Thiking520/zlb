package com.zhilianbao.erp.auth.impl.goods;


import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.transaction.interceptor.TransactionAspectSupport;

import com.zhilianbao.erp.auth.entity.goods.GoodsItemBean;
import com.zhilianbao.erp.auth.mapper.goods.GoodsItemMapper;
import com.zhilianbao.erp.auth.service.goods.IGoodsItemService;
import com.zhilianbao.erp.auth.vo.goods.GoodsItemVo;
import com.zhilianbao.erp.auth.vo.goods.GoodsSkuListVo;
import com.zhilianbao.erp.common.vo.ResponseResult;
@Service
@Transactional
public class GoodsItemServiceImpl implements IGoodsItemService {
	
	private static Logger logger=LogManager.getLogger(GoodsItemServiceImpl.class);
	
	@Autowired
	GoodsItemMapper goodsItemMapper;
	
	@Override
	public void add(GoodsItemVo goodsItemVo) {
		GoodsItemBean goodsItemBean = new GoodsItemBean();
		goodsItemBean.setGoodsId(goodsItemVo.getGoodsId());
		goodsItemBean.setGoodsStockId(goodsItemVo.getGoodsStockId());
		goodsItemMapper.insertSelective(goodsItemBean);
	}

	@Override
	public ResponseResult<GoodsSkuListVo> updateConversionRate(GoodsItemVo vo) {
		ResponseResult<GoodsSkuListVo> rspResult = new ResponseResult<GoodsSkuListVo>();
		try {
			// update
			GoodsItemBean goodsItemBean = new GoodsItemBean();
			goodsItemBean.setGoodsId(vo.getGoodsId());
			goodsItemBean.setRelateOriginalGood(vo.getRelateOriginalGood());
			goodsItemBean.setConversionRate(vo.getConversionRate());
			goodsItemMapper.updateConversionRate(goodsItemBean);
		} catch (Exception e) {
			logger.error("【商品管理-转换率配置】单品修改出错{}", vo, e);
			// 回滚
			TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
			return rspResult.err();
		}
		return rspResult;
	}
	
}
